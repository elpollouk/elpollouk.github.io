// ChickenVis
// Version: 0.10.1-dev
// Built: 2016-11-27T01:32:56.457Z
// Commit: 713fd07348d7944b6fb4abcfaaca3df4d1867017

"use strict";Chicken.register("ChickenVis.createElement",function(t){return document.createElement(t)}),Chicken.register("ChickenVis.requestAnimationFrame",function(t){return window.requestAnimationFrame(t)}),Chicken.register("ChickenVis.resolveElement",function(t){switch(typeof t){case"string":return document.getElementById(t);case"function":return t();default:return t}}),Chicken.register("ChickenVis.Loader",["ChickenVis.createElement"],function(t){var e={},i=Chicken.Class(function(){this.numReady=0,this.numTotal=0,this.failed=[],this.a={}},{queue:function(t,e){var n=this;n.numTotal+=t.length;for(var r=0;r<t.length;r++){var s=i.load(t[r].source,t[r].type,function(t){switch(t.state){case i.STATE_READY:n.numReady++;break;case i.STATE_ERROR:n.failed.push(t)}e(t,n)});s.id=t[r].id,n.a[s.id]=s}},getInfo:function(t){return this.a[t]},getData:function(t){var e=this.a[t];if(e)return e.state!==i.STATE_READY?null:e.data}},{},{TYPE_IMAGE:"img",TYPE_TEXT:"text",STATE_QUEUED:0,STATE_READY:1,STATE_ERROR:-1,load:function(t,n,r){var s={type:n,source:t,state:i.STATE_QUEUED,onStateChange:r};return e[n](s),s},registerLoader:function(t,i){e[t]=i}});return i.registerLoader(i.TYPE_IMAGE,function(e){e.data=t("img"),e.data.src=e.source,e.data.onload=function(){e.state=i.STATE_READY,e.onStateChange(e)},e.data.onerror=function(){e.state=i.STATE_ERROR,e.onStateChange(e)}}),i}),Chicken.register("ChickenVis.Loader.textLoader",["ChickenVis.Loader","XMLHttpRequest"],function(t,e){function i(i){var n=new e;n.onload=function(){i.data=n.responseText,i.state=t.STATE_READY,i.onStateChange(i)},n.onerror=function(){i.state=t.STATE_ERROR,i.onStateChange(i)},n.open("GET",i.source,!0),n.send()}return t.registerLoader(t.TYPE_TEXT,i),i}),Chicken.register("ChickenVis.UpdateLoop",["ChickenVis.requestAnimationFrame","Date.now"],function(t,e){var i=10,n=Chicken.Class(function(n){if(!n)throw new Error("No update function specified");var r=this,s=function(){var h=e(),a=(h-r.b)/1e3;r.b=h;var o=r.c;o.push(a),o.length===i&&o.shift(),r.d||(n(a),t(s))};this.d=!0,this.e=0,this.f=s,this.g=n,this.c=[]},{step:function(t){this.g(t)}},{paused:{get:function(){return this.d},set:function(t){return t==this.d?t:(this.d=t,t||(this.b=e(),this.f()),t)},enumerable:!0},fps:{get:function(){for(var t=0,e=this.c,i=0;i<e.length;i++)t+=e[i];return 0===e?0:e.length/t},enumerable:!0}});return n}),Chicken.register("ChickenVis.Draw",["ChickenVis.resolveElement","document"],function(t,e){var i="black",n="10px Courier",r=2*Math.PI,s=function(){return!1},h=Chicken.Class(function(i,n,r){i=t(i),this.i=0,this.j=0,i.getContext?this.k=i:(this.k=e.createElement("canvas"),i.appendChild(this.k)),n=n||i.width||i.clientWidth,r=r||i.height||i.clientHeight,this.k.onselectstart=s,this.l=this.k.getContext("2d"),this.resize(n,r)},{resize:function(t,e){this.m=t,this.n=e,this.k.width=this.m,this.k.height=this.n,this.l.textBaseline="top",this.l.translate(-this.i,-this.j)},setOrigin:function(t,e){this.i=-t,this.j=-e,this.l.translate(t,e)},line:function(t,e,n,r,s){s=s||i,this.l.beginPath(),this.l.moveTo(t,e),this.l.lineTo(n,r),this.l.strokeStyle=s,this.l.stroke()},path:function(t,e){e=e||i;var n=this.l;n.beginPath(),n.moveTo(t[0].x,t[0].y);for(var r=t.length,s=1;r>s;s++)n.lineTo(t[s].x,t[s].y);n.strokeStyle=e,n.stroke()},circle:function(t,e,n,s,h){s=s||i,this.l.beginPath(),this.l.arc(t,e,n,0,r),h?(this.l.strokeStyle=s,this.l.stroke()):(this.l.fillStyle=s,this.l.fill())},rect:function(t,e,n,r,s,h){s=s||i,h?(this.l.beginPath(),this.l.rect(t,e,n,r),this.l.strokeStyle=s,this.l.stroke()):(this.l.fillStyle=s,this.l.fillRect(t,e,n,r))},image:function(t,e,i){this.l.drawImage(t,e,i)},imageEx:function(t,e,i,n,r,s,h,a,o){this.l.drawImage(t,e,i,n,r,s,h,a,o)},text:function(t,e,r,s,h){s=s||i,h=h||n,this.l.font=h,this.l.fillStyle=s,this.l.fillText(t,e,r)},clear:function(){this.l.clearRect(this.i,this.j,this.m,this.n)},save:function(){this.l.save()},restore:function(){this.l.restore()},translate:function(t,e){this.l.translate(t,e)},rotate:function(t){this.l.rotate(t)},scale:function(t,e){this.l.scale(t,e||t)}},{canvas:{get:function(){return this.k},enumerable:!0},context:{get:function(){return this.l},enumerable:!0},width:{get:function(){return this.m},enumerable:!0},height:{get:function(){return this.n},enumerable:!0}});return h}),Chicken.register("ChickenVis.FixedDeltaUpdater",[],function(){var t=Chicken.Class(function(t,e){this.g=t,this.o=e,this.reset()},{reset:function(){this.p=0,this.q=0},update:function(t){for(this.q+=t,t=this.o;this.q>=t;)this.p+=t,this.q-=t,this.g(t,this.p)}},{deltaTime:{get:function(){return this.o},enumerable:!0},currentTime:{get:function(){return this.p},enumerable:!0}});return t}),Chicken.register("ChickenVis.FixedDeltaWrapper",["ChickenVis.FixedDeltaUpdater"],function(t){return function(e,i){var n=new t(e,i);return function(t){n.update(t)}}}),Chicken.register("ChickenVis.Math",[],function(){for(var t=.25*Math.PI,e=.5*Math.PI,i=2*Math.PI,n={QUARTER_PI:t,HALF_PI:e,TWO_PI:i,degreesToRads:function(t){return t*i/360},radsToDegrees:function(t){return 360*t/i},randomInt:function(t){return Math.floor(Math.random()*t)},randomRange:function(t,e){return Math.random()*(e-t)+t},randomRangeInt:function(t,e){return Math.floor(n.randomRange(t,e))},vector2:function(t,e){return{x:t,y:e}},clone2:function(t){return{x:t.x,y:t.y}},length2:function(t){return Math.sqrt(t.x*t.x+t.y*t.y)},lengthSqrd2:function(t){return t.x*t.x+t.y*t.y},dot2:function(t,e){return t.x*e.x+t.y*e.y},angleBetween2:function(t,e){return Math.atan2(t.y,t.x)-Math.atan2(e.y,e.x)},distanceBetween2:function(t,e){var i=e.x-t.x,n=e.y-t.y;return Math.sqrt(i*i+n*n)},distanceBetweenSqrd2:function(t,e){var i=e.x-t.x,n=e.y-t.y;return i*i+n*n},add2:function(t,e){t.x+=e.x,t.y+=e.y},addAndClone2:function(t,e){return{x:t.x+e.x,y:t.y+e.y}},sub2:function(t,e){t.x-=e.x,t.y-=e.y},subAndClone2:function(t,e){return{x:t.x-e.x,y:t.y-e.y}},normalise2:function(t){if(0!==t.x||0!==t.y){var e=n.length2(t);t.x/=e,t.y/=e}},normaliseAndClone2:function(t){if(0===t.x&&0===t.y)return{x:0,y:0};var e=n.length2(t);return 0===e?{x:0,y:0}:{x:t.x/e,y:t.y/e}},scale2:function(t,e){t.x*=e,t.y*=e},scaleAndClone2:function(t,e){return{x:t.x*e,y:t.y*e}},scaleAdd2:function(t,e,i){t.x+=e.x*i,t.y+=e.y*i},slerp2:function(t,e,i){t.x+=(e.x-t.x)*i,t.y+=(e.y-t.y)*i},slerpAndClone2:function(t,e,i){return{x:t.x+(e.x-t.x)*i,y:t.y+(e.y-t.y)*i}},rotate2:function(t,e){var i=t.x,n=t.y,r=Math.cos(e),s=Math.sin(e);t.x=r*i+s*n,t.y=r*n-s*i}},r=Object.getOwnPropertyNames(Math),s=0;s<r.length;s++)n[r[s]]=Math[r[s]];return n}),Chicken.register("ChickenVis.SpritePallette",[],function(){var t=Chicken.Class(function(t,e,i){if(this.r=t,this.s=e,this.t=i,this.l=i.context,!this.l&&i.getContext&&(this.l=i.getContext("2d")),!this.l&&i.drawImage&&(this.l=i),!this.l)throw new Error("Unable to determine target type")},{draw:function(t,e,i,n,r){var s=this.s[t];n=n||s.w,r=r||s.h,this.l.drawImage(this.r,s.x,s.y,s.w,s.h,e,i,n,r)},drawArray:function(t,e){var i,n,r,s,h=this.l,a=this.s,o=this.r;e=e||t.length;for(var u=0;e>u;u++)i=t[u],n=a[i.id],r=i.w||n.w,s=i.h||n.h,h.drawImage(o,n.x,n.y,n.w,n.h,i.x,i.y,r,s)},hasSprite:function(t){return t in this.s}},{img:{get:function(){return this.r},enumerable:!0},map:{get:function(){return this.s},enumerable:!0},target:{get:function(){return this.t},enumerable:!0},context:{get:function(){return this.l},enumerable:!0}});return t}),Chicken.register("ChickenVis.TileMap",[],function(){var t=Chicken.Class(function(t){if(!t.pallette)throw new Error("No pallette provided in spec");var e=t.mapWidth*t.mapHeight;if(t.mapArray.length<e)throw new Error("mapArray is too short for required map size. Expected "+e+", actual "+t.mapArray.length);this.u=t.pallette,this.v=t.mapWidth,this.z=t.mapHeight,this.A=t.tileWidth,this.B=t.tileHeight,this.C=t.viewWidth,this.D=t.viewHeight,this.F=t.x||0,this.G=t.y||0,this.s=t.mapArray,this.H=t.mapWidth*t.tileWidth-t.viewWidth,this.I=t.mapHeight*t.tileHeight-t.viewHeight,this.J=Math.ceil(this.C/this.A)+1,this.K=Math.ceil(this.D/this.B)+1,this.L=new Array(this.J*this.K),this.M=this.v-this.J,this.scrollTo(0,0)},{scrollTo:function(t,e){0>t?t=0:t>this.H&&(t=this.H),0>e?e=0:e>this.I&&(e=this.I),this.N=t,this.O=e,this.P=Math.floor(t/this.A),this.Q=Math.floor(e/this.B),this.R=t%this.A,this.S=e%this.B},scrollBy:function(t,e){this.scrollTo(this.N+t,this.O+e)},T:function(t){var e=this.F,i=this.G,n=this.C,r=this.D;t.beginPath(),t.rect(e,i,n,r),t.clip()},render:function(){var t=this.F,e=this.G,i=this.A,n=this.B,r=this.v,s=this.Q*r+this.P,h=this.J,a=this.K,o=this.M,u=this.s,c=this.u.context,l=this.L,f=0;c.save(),this.T(c),t-=this.R,e-=this.S;for(var d=t,g=e,m=0;a>m;m++){for(var y=0;h>y&&!(s>=u.length);y++){var p=u[s];null!==p&&(l[f++]={id:p,x:d,y:g,w:i,h:n}),d+=i,s++}g+=n,d=t,s+=o}this.u.drawArray(l,f),c.restore()},getTileIndexAt:function(t,e){if(t<this.x||t>=this.F+this.C)return-1;if(e<this.y||e>=this.G+this.D)return-1;t-=this.F,e-=this.G,t+=this.R,e+=this.S;var i=this.P+Math.floor(t/this.A),n=this.Q+Math.floor(e/this.A),r=n*this.v+i;return r>=this.s.length?-1:r}},{mapWidth:{get:function(){return this.v},enumerable:!0},mapHeight:{get:function(){return this.z},enumerable:!0},map:{get:function(){return this.s},enumerable:!0},pallette:{get:function(){return this.u},enumerable:!0}});return t}),Chicken.register("ChickenVis.AnimatedSprite",["ChickenVis.FixedDeltaUpdater"],function(t){var e=Chicken.Class(function(e,i){this.U=e,this.V=0,this.W=i.frameWidth,this.X=i.frameHeight,this.Y=i.renderWidth||this.W,this.Z=i.renderHeight||this.X,this.$=this.W*i.numFrames;var n=this;this._=new t(function(){n.V+=n.W,n.V>=n.$&&(n.V=0)},i.frameTime)},{update:function(t){this._.update(t)},render:function(t){t.imageEx(this.U,this.V,0,this.W,this.X,0,0,this.Y,this.Z)}});return e}),Chicken.register("ChickenVis.Bootstrap",["window","document","ChickenVis.Draw","ChickenVis.UpdateLoop","ChickenVis.FixedDeltaWrapper"],function(t,e,i,n,r){var s=Chicken.Class(function(t,e){this.draw=t,this.currentMode=e;var i=this;this.aa=new n(function(t){i.ba(t)})},{step:function(t){this.aa.step(t)}},{currentMode:{get:function(){return this.ca},set:function(t){this.ca&&this.ca.onShutdown&&this.ca.onShutdown(this),this.ca=t;var e=this;if(t.onUpdate)if(t.updateDelta){var i=r(function(i){t.onUpdate(e,i)},t.updateDelta);this.ba=function(n){i(n),t.onFrame(e,n)}}else this.ba=function(i){t.onUpdate(e,i),t.onFrame(e,i)};else this.ba=function(i){t.onFrame(e,i)};t.onInit&&t.onInit(this)}},paused:{get:function(){return this.aa.paused},set:function(t){return this.aa.paused=t,t},enumerable:!0},fps:{get:function(){return this.aa.fps},enumerable:!0}}),h=function(n){var r=e.body,h=new i(r);r.style.padding="0",r.style.margin="0",h.canvas.style.width="100%",h.canvas.style.height="100%";var a=new s(h,n);return t.onresize=function(){a.draw.resize(r.clientWidth,r.clientHeight)},a};return h}),Chicken.register("ChickenVis.ActionGroup",[],function(){var t=Chicken.Class(function(t){this.da=t,this.ea=[]},{add:function(t){Array.isArray(t)||(t=[t]);for(var e=0;e<t.length;e++)this.ea.push(t[e]);var i=this;return function(){i.remove(t)}},remove:function(t){Array.isArray(t)||(t=[t]);for(var e=0;e<t.length;e++)for(var i=0;i<this.ea.length;i++)t[e]===this.ea[i]&&this.ea.splice(i,1)},clear:function(){this.ea=[]},invoke0:function(){for(var t=this.da,e=this.ea,i=0;i<e.length;i++)e[i][t]()},invoke1:function(t){for(var e=this.da,i=this.ea,n=0;n<i.length;n++)i[n][e](t)},invoke2:function(t,e){for(var i=this.da,n=this.ea,r=0;r<n.length;r++)n[r][i](t,e)}},{action:{get:function(){return this.da}},count:{get:function(){return this.ea.length},enumerable:!0}});return t});